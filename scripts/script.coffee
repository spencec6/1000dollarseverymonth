# -- CONSTANTS

CONTENT = {}

CONTENT.header = [
  "Hello there!",
  "The catch",
  "You're not lazy are you?",
  "I knew you were better than that.",
  "Money doesn't grow on trees.",
  "Alright, let's crunch some numbers.",
  "The grey area",
  "The inflation boogeyman",
  "Automation is replacing our jobs",
  "Great!",
  "This is why <br>we can't have nice things."
]

CONTENT.message = [
  "How would you like to receive <b>$1000</b> every month?",

  "Well, there is a little bit of a catch, tbh. There are some things you’ll need to consider before, and it
  will require a little bit of work after that.",

  "<p>Ok, great. But before we start, we just need to make sure we’re not just throwing the money
  down the drain.</p><p>When you receive your <b>$1000</b> every month, you’re not just going to quit your
  job to become a lazy, netflix binging, cheeto gobbler are you?",

  "<p>Actually, most people are better than that. So far, 98% of the people who have taken this survey also agree.
  This actually makes quite a bit of sense, because there have been many studies to show us that we tend to be
  <a href='//www.ted.com/talks/dan_pink_on_motivation'>driven by internal motivators</a> such as mastery, purpose and autonomy. On top of this, there have actually
  been many experiments where this has already happened, and <a href='http://qz.com/765902/ubi-wouldnt-mean-everyone-quits-working/'>the results</a> have been very similar.</p>
  <p>Also, when welfare subsidies are contingent on conditions like employment, income level, number of hours worked, family status, etc, there are opportunities to game the system, either by illegally lying (fraud) or by simply obeying the economic incentives put in front of you (waste/abuse).</p><p>These cause losses of real economic value, which are paid for by every taxpayer. Removing this incentive structure allows confidence in the welfare system's ability to reach people exactly as intended.</p>
  <p>Anyways, I’m assuming you’re still a little puzzled about this idea of receiving <b>$1000</b> a month for
  no apparent reason. Am I right?</p>",

  "Yes, you’ve been told this patronizingly for most of your life, I’m sure. Or perhaps, you’re the one
  spreading this wisdom. It is very true. However, there have actually been a lot of very smart and
  experienced economists who have actually designed a system where this money could be accessible to
  every citizen of {Canada}. There is some restructuring involved, and your taxes would likely increase
  a couple %. However, nearly every citizen would experience a positive increase in overall wealth.",

  "To give every Canadian <b>$1000</b> every month for one year, it would cost:
  <div class='numerals'><span class='single'>35,160,000</span><span class='description'>(Canadian population)</span><br> × 1000 <span class='description'>($1000 dollars each)</span><br><div class='result'><span class='single'>$35,160,000,000</span>
<span class='description'>(cost per month)</span></div><span class='single'>$35,160,000,000</span><span class='description'>(cost per month)</span><br>× 12 <span class='description'>(months in a year)</span><br><div class='result'><span class='single'>$4,219,200,000,000</span> <span class='description'>(annual expense)</span></div> <strong><span class='single'>$421,920,000,000</span></strong> </div>
  Oh dear! Where would we ever scrape together that kind of cash? Some kind of national lottery service?
  These are a few main revenue sources these economists have proposed:
  SOURCE 1: Dissolve Ineffective Bureaucracy
  Currently, it’s estimated that for all tax revenue that goes towards social programs, such as Employment Insurance, Minimum Wage, Welfare, Public Housing, etc, 2/3s of that money is spent on administering the money. This means for every $100 you pay towards social services through tax, approximately only $33 of that is being spent on the people it is intended to go to. It’s estimated that replacing these programs with the Universal Basic Income would save over {$400,000,000 per year}.
  SOURCE 2:
  SOURCE 3:
  SOURCE 4:
  Ok, well that felt kind of good didn’t it? Kind of like some post spring cleaning satisfaction.
  So, where are we at right now?
  We now understand that we are able to give every {Canadian} <b>$1000</b> every month with some restructuring.
  And we understand that people aren’t going to just use this money to become lazy, no good, system suckers.
  But, you’re a very critical thinker, and I’m assuming you still have more questions.
  Perhaps, you believe that this would inflate our economy?",

  "The program cuts we mention above don’t have to be all or nothing.
  For example, disability and pensions can exist in smaller forms on top of UBI and still
  drastically reduce overhead costs. For those who are actually disabled and require more
  money above the UBI, we have two viable options.
  1.  Universal Health Care can potentially take care of these costs entirely or at least partially.
  2.  We top up those who need more, so if someone is currently getting $1,500 per month on
  disability and needs the extra $500, we give them the extra $500 through the disability program.
  Hey now, what about nuking bureaucracy!? Isn’t this a program that requires administration?
  You’re right, it is. However, it's now much smaller and needs fewer people. If the department
  right now is handling 2 applications for disability per 100 workers, and after UBI that goes down
  to 0.5 or less, that's at least a 75% reduction in the workload, and thus potentially a 75% reduction
  in overhead. So say instead of requiring a department of 1,000 federal employees, it can be a department
  of 250 or less. That's less bureaucracy and less potential for fraud and waste.",

  "Inflation is not the unmanageable danger it is made out to be.
  There are multiple factors which counter the fear of inflation:
  <br>•  A basic income will be set at a basic level
  <br>•  We have actual evidence
  <br>•  Capitalism will actually be enhanced
  <br>•  Technology will continue to advance and make goods like housing cheaper
  <br>•  Our economic capacity is underutilized and underconsumption is systemic
  <br>This has been one of the most numerous concerns with implementing a Universal Basic Income,
  and has been asked so many times, that Scott Santens has compiled many sources, examples, studies,
  and insight as to how inflation would not be affected through a UBI in a helpful article here.
  Assuming the BI is funded via taxes, and not monetary policy (printing money), any inflationary
  impact should be short-term and limited to where supply is sticky.
  Ok, so now that we’re past that hurdle. Since you started this survey, there has probably been
  one question in your head that hasn’t been addressed yet… Why is this even necessary?",

  "Humans have been utilizing technology to create more effective production for thousands of years.
  As we witnessed in the industrial revolution (and all technological revolutions since the dawn of time),
  with the advent of new technology
  <br>•  efficiency increased
  <br>•  accuracy increased
  <br>  <br>•  speed increased
  <br>•  consistency increased
  <br>•  power increased
  <br>•  and ultimately production increased
  The same is happening with the automation revolution, however there is one major difference.
  The previous revolutions have brought about new technologies, new jobs, and new opportunities
  for humans to contribute to. With this current situation however, new jobs are being created at a
  much smaller rate than ever before. It’s expected that {7,000,000 Canadian} jobs will be lost due
  to automation by the year 2020, while only {2,000,000} new jobs will spawn from these changes.
  That’s {5,000,000} jobs lost in under 3 years.
  In fact, our current situation is similar to a game of musical chairs where the chairs represent
  jobs. However, when the music stops, and someone is left without a chair, they aren’t just out of
  the game, they are left to stand in the hot coals of poverty. It’s said that these coals are supposed
  to motivate us to try and get a chair, but as we know now, there are simply not enough chairs for
  everyone to sit, and people will be burnt for no fault of their own. So this game sounds kind of
  disturbingly twisted, don’t you think?
  Now, let’s take this same game, but add a {10cm} thick concrete pad between the chairs and the coals.
  The pad is still pretty warm, because it’s directly above the coals, but it’s enough to prevent the
  players from getting burnt. We actually have a system which would automatically and incrementally
  add a millimeter of concrete as our economy grows stronger. So, essentially, the less chairs that
  exist, the thicker our concrete pad becomes, and the more comfortable it is to do whatever we choose on that pad.
  We are, with every day, becoming more and more productive as a society, and this will continue exponentially
  as our technology becomes more and more advanced. When our society is more productive, our economy
  becomes stronger. When our economy becomes stronger, our quality of life increases. This all sounds a
  little better, doesn’t it?",

  "<p>Although, I am sorry to admit, this system isn’t quite available yet. But, there are a few things you
  can do to help it come to fruition.
    <ol>
      <li>Sign this <a href='https://www.change.org/p/jean-yves-duclos-parl-gc-ca-a-basic-income-in-
      canada'>petition</a> to show your MPs and the Prime Minister you want to implement Basic Income
      federally in Canada.</li>
      <li>Spread the word! Share this site with your friends, family and coworkers.</li>
      <li>Volunteer: http://www.basicincomecanada.org/volunteer</li>
      <li>Donate: https://bicn.nationbuilder.com/donate</li>
      <li>Join your local network: http://www.basicincomecanada.org/local_networks</li>
    </ol>
  </p>",

  "You suck and you don't deserve the money anyways.",
]

CONTENT.options = [
  [
    ["<span class='answer'>Yes.</span><span class='description'>Sign me up now!</span>", "end1"],
    ["<span class='answer'>Sure,</span><span class='description'>but there's obviously a catch.</span>", 1],
    ["<span class='answer'>No.</span><span class='description'>I'm content with my current finances.</span>", "end2"]
  ]
  [
    ["<span class='answer'>Ok,</span><span class='description'>let's hear it.</span>", 2],
    ["<span class='answer'>Ew,</span><span class='description'>I've never been a big fan of work.</span>", "end2"]
  ]
  [
    ["<span class='answer'>No,</span><span class='description'>probably not.</span>", 3],
    ["<span class='answer'>Maybe,</span><span class='description'>it's hard to say. That does sound pretty nice.</span>", "end2"]
  ]
  [
    ["<span class='answer'>Yeah,</span><span class='description'>I'm still not sold. Where would this money even come from?</span>", 4],
    ["<span class='answer'>No,</span><span class='description'>I think I see value in this already. Sign me up!</span>", "end1"]
  ]
  [
    ["<span class='answer'>Research?</span><span class='description'>No thanks. Just show me the main sources of revenue.</span>", 5],
    ["<span class='answer'>Wow.</span><span class='description'>I've done the research and it makes total sense. Sign me up!</span>", "end1"]
  ]
  [
    ["<span class='answer'>Hold on.</span><span class='description'>What about citizens who are currently receiving disability?</span>", 6]
    ["<span class='answer'>Yeah,</span><span class='description'>that's what I was thinking.</span>", 7],
    ["<span class='answer'>No,</span><span class='description'>this actually all seems quite feasible. Sign me up!</span>", "end1"]
  ]
  [
    ["<span class='answer'>Ok,</span><span class='description'>that makes sense, but I'm still concerned about inflation.</span>", 8],
    ["<span class='answer'>Yeah,</span><span class='description'>that seems reasonable. Sign me up!</span>", "end1"]
  ]
  [
    ["<span class='answer'>Yes,</span><span class='description'>you’re a mind reader. Tell me why it’s necessary.</span>", 9],
    ["<span class='answer'>Well,</span><span class='description'>it already sounds good to me. Sign me up!</span>", "end1"]
  ]
  [
    ["<span class='answer'>Ok,</span><span class='description'>I'm convinced. Sign me up!</span>", "end1"]
  ],
  [
    ["",""]
  ],
  [
    ["",""]
  ]
]

# -- DETERMINE NUMBER OF ENDINGS
a = 0
max = 0
while a < CONTENT.options.length
  b = 0
  while b < CONTENT.options[a].length
    d = CONTENT.options[a][b][1]
    if isNaN(d)
      n = Number(d.replace("end",""))
      if n > max
        max = n
    b++
  a++
END = max

$(document).ready ->

# -- STATE

#  if sessionStorage.getItem("frame").length <= 0
#    sessionStorage.setItem("frame", 0)
#    transitionContent(sessionStorage.getItem("frame"))

# -- SELECTOR VARIABLES

  header = $(".headline")
  message = $(".message")
  logo = $(".logo")
  signup = $(".signUp")
  tab = $(".tab")
  footer = $(".footer")
  imagery = $(".imagery")
  optionContent = $(".option")
  optionText = $(".option-text")
  surveyOption = $(".survey-option")
  icon = $(".icon")
  main = $("main")
  wrapper = $(".wrapper")
  CONTENT_MARGIN = Number(wrapper.css("margin-top").replace("px",""))
  win = $(window)
  doc = $(document)
  window.longText = false

  illoGroup = $(".illustration-group")

# -- METHODS

  transitionContent = (f) ->
    removeContent(optionContent, optionContent.length, 1500)
    removeContent(illoGroup, f, 1500)
    main.addClass("hide")
    win.scrollTop(0)
    $(".icon").removeClass("selected")
    $(".frame .icon").eq(f).addClass("selected")
    o = 0
    while o <= f
      $(".frame .icon").eq(o).addClass("revealed")
      o++
    if isNaN(f)
      f = goToEnding(f)
      transitionFooter()
    setTimeout ->
      header.html(CONTENT.header[f])
      message.html(CONTENT.message[f])
      o = 0
      # o for options
      while o < CONTENT.options[f].length
        # check how many options are in the content
        optionText.eq(o).html(CONTENT.options[f][o][0])
        # populate each option element with appropriate content for frame
        o++
      surveyOption.removeClass("animate select")
      showContent(optionContent, CONTENT.options[f].length, 0)
      showContent(illoGroup, f, 1500)
      sessionStorage.setItem("frame", f++)
      # save current frame as a session state
      setTimeout =>
        showFooter() if scrolledDown()
        main.removeClass("hide")
      , 500
    , 2000

  scrolledDown = ->
    return doc.scrollTop() + win.height() > doc.height() - 50

  hideFooter = (evt) ->
    footer.addClass("hide")
    tab.addClass("hide")
    setTimeout (-> tab.removeClass("hide rotate")), 1000 unless evt == "half"

  showFooter = ->
    tab.addClass("hide rotate")
    setTimeout ->
      footer.removeClass("hide")
      tab.removeClass("hide")
    , 1000

  showContent = (cntnt, nmbr, time) ->
    #cntnt = the content that you want to show
    #nmbr = the index of that particular content
    #time = the duration of fading animation.

    if cntnt.html().indexOf("illustration") > -1
      cntnt.eq(nmbr).fadeIn(time)
    else
      x = 0
      while x <= nmbr - 1 # minus 1 to accomodate integer / zero based numeral changeup
        cntnt.eq(x).fadeIn(time)
        x++

  removeContent = (cntnt, nmbr, time) ->
    #cntnt = the content that you want to show
    #nmbr = the index of that particular content
    #time = the duration of fading animation.
    x = 0
    while x <= cntnt.length
      unless x == nmbr
        cntnt.eq(x).fadeOut(time)
      x++

  goToEnding = (f) ->
    selectedEnding = Number(f.replace("end",""))
    return CONTENT.options.length - END + selectedEnding - 1

# -- ONLOAD

#  transitionContent(sessionStorage.getItem("frame"))
  transitionContent(0)

# -- LISTENERS

  surveyOption.click ->
    idx = surveyOption.index(this)

    surveyOption.removeClass("animate select")
    surveyOption.eq(idx).addClass("animate select")

    setTimeout ->
      hideFooter('half')
      setTimeout (->
        changeFrameTo = CONTENT.options[sessionStorage.getItem("frame")][idx][1]
        transitionContent(changeFrameTo)
      ), 1500
    , 2000

  tab.click =>
    tab.toggleClass("hide")
    footer.toggleClass("hide")
    setTimeout (-> tab.toggleClass("hide rotate")), 1000

  logo.click ->
    transitionContent(0)

  icon.click ->
    idx = icon.index(this)
    if icon.eq(idx).hasClass("revealed") && !icon.eq(idx).hasClass("selected")
      transitionContent(idx)

  signup.click ->
    transitionContent("end1")

  win.scroll ->
    showFooter() if scrolledDown()

  if window.addEventListener
    kkeys = []
    ubi = "85,66,73"
    window.addEventListener "keydown", (e) ->
      kkeys.push(e.keyCode)
      if kkeys.toString().indexOf(ubi) >= 0
        goToFrame = e.keyCode
        console.log goToFrame
        kkeys = []
        sessionStorage.setItem("frame", goToFrame)
    , true
